/*!
 UI components 
 (c) Sean Hogan, 2008,2012,2014
 Mozilla Public License v2.0 (http://mozilla.org/MPL/2.0/)
*/
Meeko.sprockets.UI=(function(){var s=Meeko.stuff,q=Meeko.DOM;var j=Meeko.sprockets,l=j.Base,o=j.RoleType;var h=(Object.defineProperty&&Object.create)?function(v,u){s.forEach(s.words(u),function(B){var z=f(B);var y="get"+z;var w=v[y];if(typeof w!=="function"){w=function(){throw"Attempt to read write-only property";};}var x="set"+z;var A=v[x];if(typeof A!=="function"){A=function(){throw"Attempt to write read-only property";};}Object.defineProperty(v,B,{get:w,set:A});});}:function(v,u){};function f(u){return u.substr(0,1).toUpperCase()+u.substr(1);}var n=j.evolve(o,{setHidden:function(v){var u=this.element;if(!v){u.removeAttribute("hidden");}else{u.setAttribute("hidden","");}},getHidden:function(){var u=this.element;return u.getAttribute("hidden")!==null;}});h(n.prototype,"hidden");var r=j.evolve(n,{getListElement:function(){var w=this.element;var v=w.children;for(var x,u=0;x=v[u];u++){switch(x.tagName.toLowerCase()){case"ol":case"ul":case"select":return x;}}return null;},setSelected:function(v){var u=this.element;u.setAttribute("aria-selected",!!v);},getSelected:function(){var u=this.element;var v=u.getAttribute("aria-selected");return(/^true$/i.test(v));},setExpanded:function(u){var v=this.getListElement();if(!v){throw"";}c(v).setHidden(!u);},getExpanded:function(){var u=this.getListElement();if(!u){throw"";}return c(u).getHidden();}});h(r.prototype,"listElement selected expanded");var k=r;var c=j.evolve(n,{getItems:function(){var v=this.element;var u=[];for(var w=v.firstChild;w;w=w.nextSibling){if(w.nodeType===1){u.push(w);}}return u;}});h(c.prototype,"items");var p=j.evolve(n,{getListElement:r.prototype.getListElement,getItems:function(){return c(this.getListElement()).getItems();},getSelectedItem:function(){var u=this.getItems();var y=u.length;for(var v=0;v<y;v++){var w=u[v];var x=r(w);if(x.getSelected()){return w;}}return null;},selectItem:function(x){var u=this.getItems();if(!s.includes(u,x)){throw"Element doesn't exist in list";}var z=u.length;for(var v=0;v<z;v++){var w=u[v];var y=r(w);if(w===x){y.setSelected(true);}if(w!==x){y.setSelected(false);}}this.signalChange();},signalChange:function(){this.trigger({type:"change"});}});h(p.prototype,"listElement selectedItem");var a=j.evolve(r,{getView:function(){var x=this.element;var u=x.ownerDocument;for(var y=this.element.firstChild;y;y=y.nextSibling){if(y.nodeType===1){break;}}var w=y&&y.tagName.toLowerCase();switch(w){case"a":if(!y.getAttribute("href")){break;}var v=y.href;var z=u.URL.replace(/#.*$/,"")+"#";if(v.indexOf(z)!=0){break;}var A=v.replace(z,"");return q.findId(A);break;case"label":var A=y.htmlFor;if(A){return q.findId(A);}break;}return null;}});h(a.prototype,"view");var i=j.evolve(p,{getView:a.prototype.getView});h(i.prototype,"view");var b=j.evolve(n,{setView:function(v){var u=this.element;if(u===v||!this.contains(v)){throw"setView failed: item is not descendant of ScrollBox";}u.scrollTop=v.offsetTop-u.offsetTop;}});h(b.prototype,"view");var t=j.evolve(n,{setView:function(w){var v=this.element;var u=v.ownerDocument;if(v===w||!this.contains(node)){throw"setView failed: item is not descendant of ScrollBoxWithResize";}v.style.height=""+w.clientHeight+"px";v.scrollTop=w.offsetTop-v.offsetTop;},initialize:function(){var u=this.element;u.style.overflow="hidden";u.style.height="0px";}});h(t.prototype,"view");var m=n;var g=j.evolve(n,{getPanels:function(){return this.element.children;},setView:function(w){var v=this.element;var u=this.getPanels();if(!s.includes(u,w)){throw"setView failed: item is not child of SwitchBox";}s.forEach(u,function(y){var x=m(y);if(w==y){x.setHidden(false);}else{x.setHidden(true);}},this);},setViewByIndex:function(v){var u=this.getPanels();if(v>=u.length){throw"setViewByIndex failed: index is not valid for SwitchBox";}s.forEach(u,function(y,w){var x=m(y);if(v==w){x.setHidden(false);}else{x.setHidden(true);}},this);return;},initialize:function(){this.setView();}});h(g.prototype,"view");var e=j.evolve(n,{getTable:function(){var u=this.element;if(u.tagName.toLowerCase()==="table"){return u;}return q.find("table",u);},getColumns:function(){var u=this.getTable();return u.tHead.rows[0].cells;},sort:function(x,B,A){var F=this.getTable();var I=F.tBodies;for(var y=0,w=I.length;y<w;y++){var C=I[y];var H=C.rows;var E=[];for(var z=0,v=H.length;z<v;z++){var G=H[z];var D=G.cells[x];var u=new String(D.firstChild.nodeValue);u.row=G;E.push(u);}switch(B){case"string":E=E.sort();break;case"number":E=E.sort(function(K,J){return Number(K)-Number(J);});break;default:throw"Unrecognized sort type: "+B;break;}if(A){E=E.reverse();}for(var v=E.length,z=0;z<v;z++){var u=E[z];var G=u.row;C.removeChild(G);if(z==v-1){C.appendChild(G);}else{C.insertBefore(G,C.rows[z]);}}}},toggleColumnSortState:function(x){var C="string";var D=this.getColumns();var w=D[x];var v=new l(w);if(v.hasClass("number")){C="number";}if(v.hasClass("string")){C="string";}var z=v.hasClass("sortable");var B=v.hasClass("sorted");var A=v.hasClass("reversed");if(!z){return;}if(!B){this.sort(x,C,false);v.addClass("sorted");v.removeClass("reversed");}else{this.sort(x,C,!A);if(A){v.removeClass("reversed");}else{v.addClass("reversed");}}for(var u=D.length,y=0;y<u;y++){if(x!=y){w=D[y];v=new l(w);v.removeClass("sorted");v.removeClass("reversed");}}}});var d=j.evolve(o,{encode:function(){var v=[];s.forEach(this.elements,function(w){if(w.name){v.push(w.name+"="+encodeURIComponent(w.value));}});var u=v.join("&");return u;}});return{Base:l,Box:n,List:c,TreeItem:r,Tree:p,NavTreeItem:a,NavTree:i,Panel:m,ScrollBox:b,ScrollBoxWithResize:t,SwitchBox:g,Table:e,WF2FormElement:d};})();